// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Article {
  id            String   @id @default(cuid())

  // Content
  title         String
  slug          String   @unique // URL-friendly version
  excerpt       String   @db.Text
  content       String   @db.Text // Markdown


  // Metadata
  author        String   @default("Amir H. Jalali")
  tags          String[] // Array of tags
  imageUrl      String?
  readTime      String
  metadata      Json?    // Flexible metadata for AI generation details

  // Classification
  aiGenerated   Boolean  @default(false)
  published     Boolean  @default(false)
  featured      Boolean  @default(false)

  // Timestamps
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  publishedAt   DateTime?

  // Relations
  versions      ArticleVersion[]

  @@index([published, publishedAt])
  @@index([slug])
}

model ArticleVersion {
  id            String   @id @default(cuid())
  articleId     String
  article       Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  // Versioned content
  title         String
  content       String   @db.Text
  excerpt       String   @db.Text

  // Version metadata
  versionNumber Int
  createdAt     DateTime @default(now())
  createdBy     String   @default("system")
  changeNote    String?

  @@index([articleId, versionNumber])
}

model Draft {
  id          String   @id @default(cuid())
  title       String
  content     String   @db.Text
  excerpt     String?  @db.Text
  tags        String[]
  imageUrl    String?
  aiGenerated Boolean  @default(false)
  readTime    String?
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
